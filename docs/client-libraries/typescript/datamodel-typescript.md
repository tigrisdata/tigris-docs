# Data Modeling

Tigris enables the data models to be declared as part of the
application code. These data models are then converted to appropriate
objects, such as collections, on the backend.

In this section we will cover data modeling using TypeScript.

## Declaring Models

There are two basic constructs for TypeScript Tigris modeling.

1. Data containers - interface that holds the data model
2. Schema of Data containers - TigrisSchema definition of these data containers.

```typescript
// data container
interface User extends TigrisCollectionType {
  userId?: number;
  name: string;
  balance: number;
}

// schema definition
const userSchema: TigrisSchema<User> = {
  userId: {
    type: TigrisDataTypes.INT32,
    primary_key: {
      order: 1,
      autoGenerate: true,
    },
  },
  name: {
    type: TigrisDataTypes.STRING,
  },
  balance: {
    type: TigrisDataTypes.NUMBER,
  },
};
```

Note:

- Developers will have to keep the data container and schema definition in
  sync.
- The primary key field is marked to autoGenerate=true, and that is why it
  is defined as an optional field.

### Primary Key

#### Defining a Primary Key

The example above demonstrates how primary key is defined. The `order`
attribute in `primaryKey` represents the order of the field in the primary key.
While `autoGenerate: true` represents that the values for this field will be
automatically generated by the Tigris server.

#### Composite Primary Key

Composite primary keys are also supported but in case of composite keys
order of the fields is important. The example below demonstrates
how the order of the fields are defined in case of a composite primary key

```typescript
// data container
interface User extends TigrisCollectionType {
  userId?: number;
  email: string;
}

// schema definition
const userSchema: TigrisSchema<User> = {
  userId: {
    type: TigrisDataTypes.INT32,
    primary_key: {
      order: 1,
      autoGenerate: true,
    },
  },
  email: {
    type: TigrisDataTypes.STRING,
    primary_key: {
      order: 2,
    },
  },
};
```

#### Auto-generated Primary Key

If no primary key is specified in the model, Tigris automatically adds a
special `_id` field of type `string` (UUID) as the primary key.

At later point if you want to read this field to your data container you can
add this field into your data container.

```typescript
export interface User extends TigrisCollectionType {
  _id: string;
  userId: number;
  name: string;
  balance: number;
}
```

Note: you do not need to explicitly mention this `_id: string` field to your
schema definition. It is available implicitly. (as long as you don't have
primary key defined)

### Embedded Data Model

Tigris offers rich documents that enable embedding related data in a single
document. Embedded models allow applications to complete database operations
with fewer queries or updates, thus reducing query activity and increasing
efficiency.

Below is an example of embedded data model. We first define the `ProductItem`
type and then embed it inside the `Order` type.

```typescript
// data containers
export interface ProductItem {
  productId: number;
  quantity: number;
}
export interface Order extends TigrisCollectionType {
  orderId?: number;
  userId: number;
  productItem: ProductItem;
  orderTotal: number;
}

// schema definitions
const productItemSchema: TigrisSchema<ProductItem> = {
  productId: {
    type: TigrisDataTypes.INT32,
  },
  quantity: {
    type: TigrisDataTypes.INT32,
  },
};
export const orderSchema: TigrisSchema<Order> = {
  orderId: {
    type: TigrisDataTypes.INT32,
    primary_key: {
      order: 1,
      autoGenerate: true,
    },
  },
  userId: {
    type: TigrisDataTypes.INT32,
  },
  orderTotal: {
    type: TigrisDataTypes.NUMBER,
  },
  productItems: {
    type: productItemSchema, // <-- here
  },
};
```

### Arrays

Your collection model can have array field. Below is an example of it.

```typescript
// data container
interface Product extends TigrisCollectionType {
  id: number;
  name: string;
  tags: string[];
}

// schema definition
const productSchema: TigrisSchema<Product> = {
  id: {
    type: TigrisDataTypes.NUMBER,
  },
  name: {
    type: TigrisDataTypes.STRING,
  },
  tags: {
    type: TigrisDataTypes.ARRAY,
    items: {
      type: TigrisDataTypes.STRING,
    },
  },
};
```
